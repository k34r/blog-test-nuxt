import{D as z,r as l,q as h,E as i,G as b,H as y,I as m,J as w,K as P,T as u,L as A,M as B,N as C,O as N,P as Q}from"./Bn0b61HB.js";const E=z("postStore",()=>{const r=l([]),d=l(null),v=l(!0),n=l(!1),f=l("desc"),p=l(""),D=async()=>{n.value=!0;try{const{$db:t}=i(),o=b(y(t,"posts"),m("createdAt",f.value),w(10)),s=await P(o);s.empty||(r.value=s.docs.map(c=>{const a=c.data();return{id:c.id,title:a.title,description:a.description,createdAt:a.createdAt instanceof u?a.createdAt:u.fromDate(new Date(a.createdAt))}}).sort((c,a)=>a.createdAt.toMillis()-c.createdAt.toMillis()),d.value=s.docs[s.docs.length-1]),v.value=s.size>0}catch(t){console.error("Ошибка при загрузке постов:",t)}finally{n.value=!1}},M=async t=>{const e=r.value.find(o=>o.id===t);return e||null},S=async t=>{try{const{$db:e}=i(),s=A(y(e,"posts")),c={...t,createdAt:u.fromDate(new Date(t.createdAt))};await B(s,c),r.value.unshift({id:s.id,...c})}catch(e){console.error("Ошибка при создании поста:",e)}},g=async()=>{if(!(!d.value||n.value||!v.value)){n.value=!0;try{const{$db:t}=i(),o=b(y(t,"posts"),m("createdAt",f.value),C(d.value),w(10)),s=await P(o);if(!s.empty){const c=s.docs.map(a=>({id:a.id,title:a.data().title,description:a.data().description,createdAt:a.data().createdAt instanceof u?a.data().createdAt:u.fromDate(new Date(a.data().createdAt))}));r.value.push(...c),d.value=s.docs[s.docs.length-1]}v.value=s.size>0}catch(t){console.error("Ошибка при загрузке дополнительных постов:",t)}finally{n.value=!1}}},q=async t=>{try{const{$db:e}=i();await N(A(e,"posts",t)),r.value=r.value.filter(s=>s.id!==t)}catch(e){console.error("Ошибка при удалении поста:",e)}},$=t=>{f.value=t,r.value.sort((e,o)=>t==="asc"?e.createdAt.toMillis()-o.createdAt.toMillis():o.createdAt.toMillis()-e.createdAt.toMillis())},x=t=>{p.value=t},I=async(t,e)=>{try{const{$db:o}=i();await Q(A(o,"posts",t),e);const c=r.value.findIndex(a=>a.id===t);c!==-1&&(r.value[c]={...r.value[c],...e})}catch(o){console.error("Ошибка при редактировании поста:",o)}},L=h(()=>r.value.filter(t=>t.title.toLowerCase().includes(p.value.toLowerCase()))),O=h(()=>r.value);return{posts:r,lastVisible:d,hasMore:v,isLoading:n,sortOrder:f,searchQuery:p,fetchPosts:D,fetchPostById:M,createPost:S,loadMorePosts:g,deletePost:q,changeSortOrder:$,setSearchQuery:x,editPost:I,filteredPosts:L,getPosts:O}});export{E as u};
